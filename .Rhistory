colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "firebrick") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"))
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
colour = nbin),
alpha = 0.3) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "firebrick") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"))
})
fv.bmt.plt$Filt
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
colour = nbin),
fill = "white") +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "firebrick") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"))
})
fv.bmt.plt$Filt
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin)) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "firebrick") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"))
})
fv.bmt.plt$Filt
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.3) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "firebrick") +
scale_fill_gradient(low = "navy", high = "firebrick") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"))
})
fv.bmt.plt$Filt
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.5) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "firebrick") +
scale_fill_gradient(low = "steelblue", high = "tomato") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"))
})
fv.bmt.plt$Filt
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.5) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "firebrick") +
scale_fill_gradient(low = "steelblue", high = "tomato") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1)
})
fv.bmt.plt$Filt
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.5) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_gradient(low = "steelblue", high = "tomato") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1)
})
fv.bmt.plt$Filt
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.25) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_gradient(low = "steelblue", high = "tomato") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1)
})
fv.bmt.plt$Filt
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_gradient(low = "steelblue", high = "tomato") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1)
})
fv.bmt.plt$Filt
wrap_plots(fv.bmt.plt)
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_gradient(low = "steelblue", high = "tomato") +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1,
axis.title = element_blank(),
axis.ticks = element_blank(),
axis.text = element_text(size = 7),
axis.text.x = element_text(angle = 90,
hjust = 1,
vjust = 0.5))
})
wrap_plots(fv.bmt.plt)
wrap_plots(fv.bmt.plt, guides = 'collect')
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_viridis_c() +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1,
axis.title = element_blank(),
axis.ticks = element_blank(),
axis.text = element_text(size = 7),
axis.text.x = element_text(angle = 90,
hjust = 1,
vjust = 0.5))
})
wrap_plots(fv.bmt.plt, guides = 'collect')
View(fv.bmt[["Sed"]])
fv.env
fv.bmt
unique(fv.env$Sed$sample)
## Bin to function matrix
fv.bmt <- lapply(fv.env, \(dt) {
caz <- unique(dt$label)
scol <- unique(dt$sample)
d1 <- as.data.table(present_bins[, scol], keep.rownames = "bin") %>%
melt(id.vars = 'bin',
variable.name = 'sample',
value.name = 'presence') %>%
.[presence > 0]
d2 <- as.data.table(G, keep.rownames = 'bin')[N > 0 & cazyme %in% caz]
DT <- merge(d1, d2, by = "bin", all = TRUE, allow.cartesian = TRUE)
DT <- DT[
!is.na(presence)
][
, .(nbin = .N), by = .(cazyme, sample)
]
})
View(fv.bmt[["Sed"]])
G
as.data.table(present_bins[, unique(fv.env$Sed$sample)], keep.rownames = "bin")
unique(fv.env$Sed$sample)
levels(fv.env$Sed$sample)
present_bins[, unique(fv.env$Sed$sample)]
present_bins[, colnames(present_bins) %in% unique(fv.env$Sed$sample)]
present_bins[, unique(fv.env$Filt$sample)]
## Bin to function matrix
fv.bmt <- lapply(fv.env, \(dt) {
caz <- unique(dt$label)
scol <- levels(dt$sample)
d1 <- as.data.table(present_bins[, scol], keep.rownames = "bin") %>%
melt(id.vars = 'bin',
variable.name = 'sample',
value.name = 'presence') %>%
.[presence > 0]
d2 <- as.data.table(G, keep.rownames = 'bin')[N > 0 & cazyme %in% caz]
DT <- merge(d1, d2, by = "bin", all = TRUE, allow.cartesian = TRUE)
DT <- DT[
!is.na(presence)
][
, .(nbin = .N), by = .(cazyme, sample)
]
})
View(fv.bmt)
View(fv.bmt[["Sed"]])
levels(fv.env$Filt$label)
## Bin to function matrix
fv.bmt <- lapply(fv.env, \(dt) {
caz <- unique(dt$label)
scol <- levels(dt$sample)
d1 <- as.data.table(present_bins[, scol], keep.rownames = "bin") %>%
melt(id.vars = 'bin',
variable.name = 'sample',
value.name = 'presence') %>%
.[presence > 0]
d2 <- as.data.table(G, keep.rownames = 'bin')[N > 0 & cazyme %in% caz]
DT <- merge(d1, d2, by = "bin", all = TRUE, allow.cartesian = TRUE)
DT <- DT[
!is.na(presence)
][
, .(nbin = .N), by = .(cazyme, sample)
]
})
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_viridis_c() +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1,
axis.title = element_blank(),
axis.ticks = element_blank(),
axis.text = element_text(size = 7),
axis.text.x = element_text(angle = 90,
hjust = 1,
vjust = 0.5))
})
wrap_plots(fv.bmt.plt, guides = 'collect')
wrap_plots(fv.bmt.plt)
ggsave(
"sandbox/bin2cazyme2sample.matrix.tiff",
wrap_plots(fv.bmt.plt),
width = 297, height = 210, units = "mm"
)
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin)) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_viridis_c() +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1,
axis.title = element_blank(),
axis.ticks = element_blank(),
text = element_text(size = 7),
axis.text.x = element_text(angle = 90,
hjust = 1,
vjust = 0.5))
})
wrap_plots(fv.bmt.plt)
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin),
size = 7) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_viridis_c() +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1,
axis.title = element_blank(),
axis.ticks = element_blank(),
text = element_text(size = 7),
axis.text.x = element_text(angle = 90,
hjust = 1,
vjust = 0.5))
})
wrap_plots(fv.bmt.plt)
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin),
size = 7 * 14/5) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_viridis_c() +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1,
axis.title = element_blank(),
axis.ticks = element_blank(),
text = element_text(size = 7),
axis.text.x = element_text(angle = 90,
hjust = 1,
vjust = 0.5))
})
wrap_plots(fv.bmt.plt)
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin),
size = 0.5) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_viridis_c() +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1,
axis.title = element_blank(),
axis.ticks = element_blank(),
text = element_text(size = 7),
axis.text.x = element_text(angle = 90,
hjust = 1,
vjust = 0.5))
})
wrap_plots(fv.bmt.plt)
fv.bmt.plt <- lapply(fv.bmt, \(dt) {
ggplot(dt) +
geom_tile(aes(x = sample,
y = cazyme,
fill = nbin),
alpha = 0.4) +
geom_text(aes(x = sample,
y = cazyme,
label = nbin,
colour = nbin),
size = 2) +
scale_x_discrete(expand = c(0, 0)) +
scale_y_discrete(expand = c(0, 0)) +
scale_colour_gradient(low = "navy", high = "red") +
scale_fill_viridis_c() +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_line(colour = "black"),
aspect.ratio = 1,
axis.title = element_blank(),
axis.ticks = element_blank(),
text = element_text(size = 7),
axis.text.x = element_text(angle = 90,
hjust = 1,
vjust = 0.5))
})
ggsave(
"sandbox/bin2cazyme2sample.matrix.tiff",
wrap_plots(fv.bmt.plt),
width = 297, height = 210, units = "mm"
)
wrap_plots(fv.bmt.plt)
colSums(present_bins)
View(CAZYME)
tpm[CAZYME[FAMILY == "PL22"]$NODE, ]
View(cdt)
View(SUBSTRATE)
tpm[CAZYME[FAMILY == "PL22"]$NODE, ] %>% diversity(index = "inv")
tpm[CAZYME[FAMILY == "PL22"]$NODE, ] %>% diversity(t(.), index = "inv")
tpm[CAZYME[FAMILY == "PL22"]$NODE, ] %>% t() %>% diversity(index = "inv")
View(TAXONOMY)
tpm[CAZYME[FAMILY == "GH32"]$NODE, ]
tpm[CAZYME[FAMILY == "GH32"]$NODE, grepl("Filt", colnames(tpm))]
tpm[CAZYME[FAMILY == "GH32"]$NODE, grepl("Filt", colnames(tpm))] %>% split_matrix(remove_zero_rowsum = T)
View(fv.env)
View(fv.env[["Filt"]])
cdt[cazyme %in% c('GH17 | 3.2.1.39', 'GH16 | 3.2.1.39')]
colSums(present_bins[unique(cdt[cazyme %in% c('GH17 | 3.2.1.39', 'GH16 | 3.2.1.39')]$bin), ])
colSums(present_bins[unique(cdt[grepl("3.2.1.1", cazyme)]$bin), ])
cdt[grepl("3.2.1.1", cazyme)]
cdt[grepl("\\b3.2.1.1\\b", cazyme)]
colSums(present_bins[cdt[grepl("\\b3.2.1.1\\b", cazyme)]$bin, ])
colSums(present_bins[cdt[grepl("\\b3.2.1.1\\b", cazyme)]$bin, ]) / colSums(present_bins)
colSums(present_bins[cdt[grepl("\\b3.2.1.39\\b", cazyme)]$bin, ]) / colSums(present_bins)
colSums(present_bins)
colSums(present_bins[cdt[grepl("\\b3.2.1.39\\b", cazyme)]$bin, ])
colSums(present_bins[cdt[grepl("\\b3.2.1.39\\b", cazyme)]$bin, ]) / colSums(present_bins) * 100
colSums(present_bins[cdt[grepl("\\b3.2.1.1\\b", cazyme)]$bin, ]) / colSums(present_bins) * 100
colSums(present_bins[cdt[grepl("\\b3.2.1.39\\b|\\b3.2.1.6\\b", cazyme)]$bin, ]) / colSums(present_bins) * 100
colSums(present_bins[cdt[cazyme %in% c('GH16 | 3.2.1.39', 'GH17 | 3.2.1.39')]$bin, ]) / colSums(present_bins) * 100
colSums(present_bins[cdt[cazyme %in% c('GH13 | 3.2.1.1')]$bin, ]) / colSums(present_bins) * 100
?cophenetic
hcl <- hclsut(dist(fv))
hcl <- hclust(dist(fv))
cophenetic(hcl)
cop <- cophenetic(hcl)
plot(hcl)
hcl <- hclust(dist(fv[1:5]))
cop <- cophenetic(hcl)
plot(hcl)
hcl <- hclust(dist(fv[1:5, ]))
cop <- cophenetic(hcl)
plot(hcl)
cop
dist(fv[1:5, ])
