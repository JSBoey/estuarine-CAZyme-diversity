# Standardise axis names for ggplot call
names(scr)[1:2] <- c("x", "y")
# Main plotting variables
site_score <- filter(scr, score == "sites")
centroid <- filter(scr, score == "centroids")
biplot <- filter(scr, score == "biplot")
# Axis variables
axis_variation <- proportions(as.matrix(st[["axis"]][, 2]))[1:2]
axis_label <- paste0(
axis_name, " (", round(axis_variation * 100, 2), "%)"
)
ggplot() +
geom_hline(
yintercept = 0, colour = "grey40", linetype = 2
) +
geom_vline(
xintercept = 0, colour = "grey40", linetype = 2
) +
geom_point(
mapping = aes(x = x, y = y, colour = salinity, shape = type),
data = site_score
) +
geom_segment(
mapping = aes(xend = x * mul, yend = y * mul, x = 0, y = 0),
data = biplot,
arrow = arrow(length = unit(0.03, units = "npc"))
) +
geom_text(
mapping = aes(x = x, y = y, label = label),
data = centroid
) +
labs(
x = axis_label[[1]],
y = axis_label[[2]],
colour = "Salinity ‰",
shape = "Sample type"
) +
scale_colour_viridis_c(
limits = c(0, 35)
) +
scale_shape_manual(
values = c("sediment" = 15, "water" = 16),
labels = str_to_title
) +
theme_bw() +
theme(
aspect.ratio = 1,
panel.grid = element_blank()
)
}
)
### Ordination plot
CO_plot <- pmap(
list(CO_score, CO_statistic, CO_arrowMultiplier), \(scr, st, mul) {
# Get axis names prior to standardisation
axis_name <- names(scr)[1:2]
# Standardise axis names for ggplot call
names(scr)[1:2] <- c("x", "y")
# Main plotting variables
site_score <- filter(scr, score == "sites")
centroid <- filter(scr, score == "centroids")
biplot <- filter(scr, score == "biplot") %>%
mutate(
across(c(x, y), \(axis) axis * mul)
)
# Axis variables
axis_variation <- proportions(as.matrix(st[["axis"]][, 2]))[1:2]
axis_label <- paste0(
axis_name, " (", round(axis_variation * 100, 2), "%)"
)
ggplot() +
geom_hline(
yintercept = 0, colour = "grey40", linetype = 2
) +
geom_vline(
xintercept = 0, colour = "grey40", linetype = 2
) +
geom_point(
mapping = aes(x = x, y = y, colour = salinity, shape = type),
data = site_score
) +
geom_segment(
mapping = aes(xend = x, yend = y, x = 0, y = 0),
data = biplot,
arrow = arrow(length = unit(0.03, units = "npc"))
) +
geom_text(
mapping = aes(x = x, y = y, label = label),
data = centroid
) +
labs(
x = axis_label[[1]],
y = axis_label[[2]],
colour = "Salinity ‰",
shape = "Sample type"
) +
scale_colour_viridis_c(
limits = c(0, 35)
) +
scale_shape_manual(
values = c("sediment" = 15, "water" = 16),
labels = str_to_title
) +
theme_bw() +
theme(
aspect.ratio = 1,
panel.grid = element_blank()
)
}
)
CO_arrowMultiplier <- map_depth(CO, 2, ~ {
a <- ordiArrowMul(.x, display = "bp")
if (is.infinite(a)) {
a <- 1
}
return(a)
}) %>%
list_flatten()
### Ordination plot
CO_plot <- pmap(
list(CO_score, CO_statistic, CO_arrowMultiplier), \(scr, st, mul) {
# Get axis names prior to standardisation
axis_name <- names(scr)[1:2]
# Standardise axis names for ggplot call
names(scr)[1:2] <- c("x", "y")
# Main plotting variables
site_score <- filter(scr, score == "sites")
centroid <- filter(scr, score == "centroids")
biplot <- filter(scr, score == "biplot") %>%
mutate(
across(c(x, y), \(axis) axis * mul)
)
# Axis variables
axis_variation <- proportions(as.matrix(st[["axis"]][, 2]))[1:2]
axis_label <- paste0(
axis_name, " (", round(axis_variation * 100, 2), "%)"
)
ggplot() +
geom_hline(
yintercept = 0, colour = "grey40", linetype = 2
) +
geom_vline(
xintercept = 0, colour = "grey40", linetype = 2
) +
geom_point(
mapping = aes(x = x, y = y, colour = salinity, shape = type),
data = site_score
) +
geom_segment(
mapping = aes(xend = x, yend = y, x = 0, y = 0),
data = biplot,
arrow = arrow(length = unit(0.03, units = "npc"))
) +
geom_text(
mapping = aes(x = x, y = y, label = label),
data = centroid
) +
labs(
x = axis_label[[1]],
y = axis_label[[2]],
colour = "Salinity ‰",
shape = "Sample type"
) +
scale_colour_viridis_c(
limits = c(0, 35)
) +
scale_shape_manual(
values = c("sediment" = 15, "water" = 16),
labels = str_to_title
) +
theme_bw() +
theme(
aspect.ratio = 1,
panel.grid = element_blank()
)
}
)
CO_plot$wgs_TPM
CO_plot$wgs_RCLR
CO_arrowMultiplier <- map_depth(CO, 2, ~ {
a <- ordiArrowMul(.x, display = "bp")
if (is.infinite(a)) {
a <- 1
} else if (a < 1) {
a <- 3
}
return(a)
}) %>%
list_flatten()
### Ordination plot
CO_plot <- pmap(
list(CO_score, CO_statistic, CO_arrowMultiplier), \(scr, st, mul) {
# Get axis names prior to standardisation
axis_name <- names(scr)[1:2]
# Standardise axis names for ggplot call
names(scr)[1:2] <- c("x", "y")
# Main plotting variables
site_score <- filter(scr, score == "sites")
centroid <- filter(scr, score == "centroids")
biplot <- filter(scr, score == "biplot") %>%
mutate(
across(c(x, y), \(axis) axis * mul)
)
# Axis variables
axis_variation <- proportions(as.matrix(st[["axis"]][, 2]))[1:2]
axis_label <- paste0(
axis_name, " (", round(axis_variation * 100, 2), "%)"
)
ggplot() +
geom_hline(
yintercept = 0, colour = "grey40", linetype = 2
) +
geom_vline(
xintercept = 0, colour = "grey40", linetype = 2
) +
geom_point(
mapping = aes(x = x, y = y, colour = salinity, shape = type),
data = site_score
) +
geom_segment(
mapping = aes(xend = x, yend = y, x = 0, y = 0),
data = biplot,
arrow = arrow(length = unit(0.03, units = "npc"))
) +
geom_text(
mapping = aes(x = x, y = y, label = label),
data = centroid
) +
labs(
x = axis_label[[1]],
y = axis_label[[2]],
colour = "Salinity ‰",
shape = "Sample type"
) +
scale_colour_viridis_c(
limits = c(0, 35)
) +
scale_shape_manual(
values = c("sediment" = 15, "water" = 16),
labels = str_to_title
) +
theme_bw() +
theme(
aspect.ratio = 1,
panel.grid = element_blank()
)
}
)
CO_plot$wgs_RCLR
View(CO_arrowMultiplier)
CO_arrowMultiplier <- map_depth(CO, 2, ~ {
a <- ordiArrowMul(.x, display = "bp")
if (is.infinite(a)) {
a <- 1
} else if (a < 2) {
a <- 3
}
return(a)
}) %>%
list_flatten()
### Ordination plot
CO_plot <- pmap(
list(CO_score, CO_statistic, CO_arrowMultiplier), \(scr, st, mul) {
# Get axis names prior to standardisation
axis_name <- names(scr)[1:2]
# Standardise axis names for ggplot call
names(scr)[1:2] <- c("x", "y")
# Main plotting variables
site_score <- filter(scr, score == "sites")
centroid <- filter(scr, score == "centroids")
biplot <- filter(scr, score == "biplot") %>%
mutate(
across(c(x, y), \(axis) axis * mul)
)
# Axis variables
axis_variation <- proportions(as.matrix(st[["axis"]][, 2]))[1:2]
axis_label <- paste0(
axis_name, " (", round(axis_variation * 100, 2), "%)"
)
ggplot() +
geom_hline(
yintercept = 0, colour = "grey40", linetype = 2
) +
geom_vline(
xintercept = 0, colour = "grey40", linetype = 2
) +
geom_point(
mapping = aes(x = x, y = y, colour = salinity, shape = type),
data = site_score
) +
geom_segment(
mapping = aes(xend = x, yend = y, x = 0, y = 0),
data = biplot,
arrow = arrow(length = unit(0.03, units = "npc"))
) +
geom_text(
mapping = aes(x = x, y = y, label = label),
data = centroid
) +
labs(
x = axis_label[[1]],
y = axis_label[[2]],
colour = "Salinity ‰",
shape = "Sample type"
) +
scale_colour_viridis_c(
limits = c(0, 35)
) +
scale_shape_manual(
values = c("sediment" = 15, "water" = 16),
labels = str_to_title
) +
theme_bw() +
theme(
aspect.ratio = 1,
panel.grid = element_blank()
)
}
)
CO_plot$wgs_RCLR
CO_plot$wts_RCLR
CO_plot$wts_TPM
### Ordination plot
CO_plot <- pmap(
list(CO_score, CO_statistic, CO_arrowMultiplier), \(scr, st, mul) {
# Get axis names prior to standardisation
axis_name <- names(scr)[1:2]
# Standardise axis names for ggplot call
names(scr)[1:2] <- c("x", "y")
# Main plotting variables
site_score <- filter(scr, score == "sites")
centroid <- filter(scr, score == "centroids") %>%
mutate(
label = str_to_title(str_remove(label, "Type"))
)
biplot <- filter(scr, score == "biplot") %>%
mutate(
across(c(x, y), \(axis) axis * mul)
)
# Axis variables
axis_variation <- proportions(as.matrix(st[["axis"]][, 2]))[1:2]
axis_label <- paste0(
axis_name, " (", round(axis_variation * 100, 2), "%)"
)
ggplot() +
geom_hline(
yintercept = 0, colour = "grey40", linetype = 2
) +
geom_vline(
xintercept = 0, colour = "grey40", linetype = 2
) +
geom_point(
mapping = aes(x = x, y = y, colour = salinity, shape = type),
data = site_score
) +
geom_segment(
mapping = aes(xend = x, yend = y, x = 0, y = 0),
data = biplot,
arrow = arrow(length = unit(0.03, units = "npc"))
) +
geom_text(
mapping = aes(x = x, y = y, label = label),
data = centroid
) +
labs(
x = axis_label[[1]],
y = axis_label[[2]],
colour = "Salinity ‰",
shape = "Sample type"
) +
scale_colour_viridis_c(
limits = c(0, 35)
) +
scale_shape_manual(
values = c("sediment" = 15, "water" = 16),
labels = str_to_title
) +
theme_bw() +
theme(
aspect.ratio = 1,
panel.grid = element_blank()
)
}
)
CO_plot$wts_TPM
### Ordination plot
CO_plot <- pmap(
list(CO_score, CO_statistic, CO_arrowMultiplier), \(scr, st, mul) {
# Get axis names prior to standardisation
axis_name <- names(scr)[1:2]
# Standardise axis names for ggplot call
names(scr)[1:2] <- c("x", "y")
# Main plotting variables
site_score <- filter(scr, score == "sites")
centroid <- filter(scr, score == "centroids") %>%
mutate(
label = str_to_title(str_remove(label, "type"))
)
biplot <- filter(scr, score == "biplot") %>%
mutate(
across(c(x, y), \(axis) axis * mul)
)
# Axis variables
axis_variation <- proportions(as.matrix(st[["axis"]][, 2]))[1:2]
axis_label <- paste0(
axis_name, " (", round(axis_variation * 100, 2), "%)"
)
ggplot() +
geom_hline(
yintercept = 0, colour = "grey40", linetype = 2
) +
geom_vline(
xintercept = 0, colour = "grey40", linetype = 2
) +
geom_point(
mapping = aes(x = x, y = y, colour = salinity, shape = type),
data = site_score
) +
geom_segment(
mapping = aes(xend = x, yend = y, x = 0, y = 0),
data = biplot,
arrow = arrow(length = unit(0.03, units = "npc"))
) +
geom_text(
mapping = aes(x = x, y = y, label = label),
data = centroid
) +
labs(
x = axis_label[[1]],
y = axis_label[[2]],
colour = "Salinity ‰",
shape = "Sample type"
) +
scale_colour_viridis_c(
limits = c(0, 35)
) +
scale_shape_manual(
values = c("sediment" = 15, "water" = 16),
labels = str_to_title
) +
theme_bw() +
theme(
aspect.ratio = 1,
panel.grid = element_blank()
)
}
)
patchwork::wrap_plots(CO_plot)
### Ordination plot
CO_plot <- pmap(
list(CO_score, CO_statistic, CO_arrowMultiplier), \(scr, st, mul) {
# Get axis names prior to standardisation
axis_name <- names(scr)[1:2]
# Standardise axis names for ggplot call
names(scr)[1:2] <- c("x", "y")
# Main plotting variables
site_score <- filter(scr, score == "sites")
centroid <- filter(scr, score == "centroids") %>%
mutate(
label = str_to_title(str_remove(label, "type"))
)
biplot <- filter(scr, score == "biplot") %>%
mutate(
across(c(x, y), \(axis) axis * mul)
)
# Axis variables
axis_variation <- proportions(as.matrix(st[["axis"]][, 2]))[1:2]
axis_label <- paste0(
axis_name, " (", round(axis_variation * 100, 2), "%)"
)
ggplot() +
geom_hline(
yintercept = 0, colour = "grey40", linetype = 2
) +
geom_vline(
xintercept = 0, colour = "grey40", linetype = 2
) +
geom_segment(
mapping = aes(xend = x, yend = y, x = 0, y = 0),
data = biplot,
arrow = arrow(length = unit(0.03, units = "npc"))
) +
geom_point(
mapping = aes(x = x, y = y, colour = salinity, shape = type),
data = site_score
) +
geom_text(
mapping = aes(x = x, y = y, label = label),
data = centroid
) +
labs(
x = axis_label[[1]],
y = axis_label[[2]],
colour = "Salinity ‰",
shape = "Sample type"
) +
scale_colour_viridis_c(
limits = c(0, 35)
) +
scale_shape_manual(
values = c("sediment" = 15, "water" = 16),
labels = str_to_title
) +
theme_bw() +
theme(
aspect.ratio = 1,
panel.grid = element_blank()
)
}
)
patchwork::wrap_plots(CO_plot)
View(BD)
